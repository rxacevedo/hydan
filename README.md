# Hydan

Welcome to your new gem! In this directory, you'll find the files you need to be able to package up your Ruby library into a gem. Put your Ruby code in the file `lib/hydan`. To experiment with that code, run `bin/console` for an interactive prompt.

TODO: Delete this and the text above, and describe your gem

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'hydan'
```

And then execute:

    $ bundle

Or install it yourself as:

    $ gem install hydan

## Usage

### Local text encryption

Local text encryption returns a JSON object containing the cihpertext and randomly-generated data key. Plaintext can be piped into STDIN or passed on the CLI via the `--text` flag.

```
# We'll grab 256 random bits for the master key
KEY=$(head -c 32 /dev/urandom | base64)
echo 'A secret on STDIN' | hydan encrypt --master-key $KEY
{
  "ciphertext": {
    "v": 1,
    "adata": "",
    "ks": 256,
    "ct": "8VmGeR6+rtznK6Lu8vmr99PFmbxfu6FcyzWyiU17",
    "ts": 96,
    "mode": "gcm",
    "cipher": "aes",
    "iter": 100000,
    "iv": "8Pj1RuenaRqV5BRc",
    "salt": "mXfzMTw89lE="
  },
  "data_key": "eyJ2IjoxLCJhZGF0YSI6IiIsImtzIjoyNTYsImN0IjoiVlVDclRLUTV2WVpBMGFuTW9NTUQzWS9OQ0NYUkF0SWFpc3JYcFI1THVraHptUE1WeTVqRzBsbFJsM1k9IiwidHMiOjk2LCJtb2RlIjoiZ2NtIiwiY2lwaGVyIjoiYWVzIiwiaXRlciI6MTAwMDAwLCJpdiI6ImRUeTBPVUt2a3plaThkdnEiLCJzYWx0Ijoib1BQTXF2U1ZCN2c9In0="
}
```

### Local decryption
```
KEY=$(head -c 32 /dev/urandom | base64)
echo 'The Krabby Patty secret recipe IS...' | hydan encrypt --master-key $KEY | hydan decrypt --master-key $KEY
The Krabby Patty secret recipe IS...

hydan encrypt --master-key $KEY --text 'This also works' | hydan decrypt --master-key $KEY
This also works
```

#### Large files
When files are too large to read into memory, use the `--in` and `--out` flags. This will prompt `hydan` to use logic that reads and encrypts the file line-by-line, as opposed to "slurping" the file beforehand. This also implies that it's not worth Base64 encoding the encrypted output, since it will also be large. Because of this, encryption that uses the `--in` flag saves it's output in binary instead of Base64.

```
# Make a huge file
mkfile -n 10g ~/Desktop/LargeTestFile

hydan encrypt --in ~/Desktop/LargeTestFile --out ~/Desktop/LargeTestFile.bin --master-key $KEY
Data key (Base64): U2FsdGVkX18NG/y8sEFGyop79njj0R9omH+/UZ3Ijy1c8nYACE2UQt1NMvSL2Rh9GH4p+TSEZxSMqqWqzg7/Kw==

# We use the encrypted data key generated by the program in order to decrypt the file
# If `--key-out` is specified, the key will be saved to the supplied path instead of
# being printed to STDOUT.
hydan decrypt --in ~/Desktop/LargeTestFile.bin --out ~/Desktop/LargeTestFile.decrypted --master-key $KEY --data-key U2FsdGVkX18NG/y8sEFGyop79njj0R9omH+/UZ3Ijy1c8nYACE2UQt1NMvSL2Rh9GH4p+TSEZxSMqqWqzg7/Kw==

# Original
shasum -a 256 ~/Desktop/LargeTestFile
732377e7f4a2abdc13ddfa1eb4c9c497fd2a2b294674d056cf51581b47dd586d  /Users/roberto/Desktop/LargeTestFile

# Decrypted
shasum -a 256 ~/Desktop/LargeTestFile.decrypted
732377e7f4a2abdc13ddfa1eb4c9c497fd2a2b294674d056cf51581b47dd586d  /Users/roberto/Desktop/LargeTestFile.decrypted
```

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake test` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/[USERNAME]/hydan.


## License

The gem is available as open source under the terms of the [MIT License](http://opensource.org/licenses/MIT).

